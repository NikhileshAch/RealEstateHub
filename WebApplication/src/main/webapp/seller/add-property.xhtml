<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Add Property - RealEstateHub</title>
    <h:outputStylesheet library="css" name="style.css"/>
    <style>
        .pac-container {
            z-index: 99999 !important;
            font-family: 'Segoe UI', sans-serif;
        }
        .property-form-card {
            max-width: 700px;
            margin: 30px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .form-header {
            background: linear-gradient(135deg, #1a2a4a 0%, #2c3e5a 100%);
            padding: 25px;
            text-align: center;
            color: white;
        }
        .form-header h1 {
            margin: 0;
            font-size: 1.8rem;
            color: #c9a227 !important;
        }
        .form-header p {
            margin: 10px 0 0;
            opacity: 0.9;
        }
        .form-body {
            padding: 25px;
        }
        .p-field {
            margin-bottom: 18px;
        }
        .p-field label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
        }
        .ui-inputtext, .ui-selectonemenu, .ui-spinner, .ui-inputnumber, .ui-inputtextarea {
            width: 100% !important;
        }
        .form-row {
            display: flex;
            gap: 15px;
        }
        .form-row .p-field {
            flex: 1;
        }
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        .form-actions .ui-button {
            flex: 1;
        }
        .features-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        .features-section h3 {
            margin: 0 0 15px;
            color: #333;
        }
        .feature-checkboxes {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }
        .feature-checkboxes label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
    </style>
</h:head>
<h:body>
    <div class="container">
        <!-- Navigation Bar -->
        <div class="navbar">
            <div class="navbar-brand">RealEstateHub - Add Property</div>
            <div class="navbar-user">
                <span class="user-info">Welcome, #{sessionBean.userFullName}!</span>
                <h:form>
                    <p:commandButton value="My Properties" action="/seller/my-properties?faces-redirect=true" 
                                   icon="pi pi-list" styleClass="ui-button-secondary"/>
                    <p:commandButton value="Logout" action="#{sessionBean.logout()}" 
                                   icon="pi pi-sign-out" styleClass="ui-button-danger" ajax="false"/>
                </h:form>
            </div>
        </div>
        
        <div class="property-form-card">
            <div class="form-header">
                <h1>Add New Property</h1>
                <p>List your property on RealEstateHub</p>
            </div>
            
            <div class="form-body">
                <p:growl id="messages" showDetail="true" life="5000"/>
                <h:messages styleClass="messages"/>
                
                <h:form>
                    <div class="form-row">
                        <div class="p-field">
                            <label for="address">Address *</label>
                            <p:inputText id="address" value="#{propertyBean.address}"
                                         required="true" requiredMessage="Address is required"
                                         placeholder="Start typing address..."
                                         styleClass="address-input"/>
                            <p:message for="address"/>
                        </div>
                        
                        <div class="p-field">
                            <label for="propertyType">Property Type *</label>
                            <p:selectOneMenu id="propertyType" value="#{propertyBean.propertyType}" 
                                           required="true" requiredMessage="Property type is required"
                                           filter="true" filterMatchMode="contains">
                                <f:selectItem itemValue="" itemLabel="-- Select Type --"/>
                                <f:selectItem itemValue="HOUSE" itemLabel="House"/>
                                <f:selectItem itemValue="APARTMENT" itemLabel="Apartment"/>
                                <f:selectItem itemValue="CONDO" itemLabel="Condo"/>
                                <f:selectItem itemValue="TOWNHOUSE" itemLabel="Townhouse"/>
                                <f:selectItem itemValue="VILLA" itemLabel="Villa"/>
                            </p:selectOneMenu>
                            <p:message for="propertyType"/>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="p-field">
                            <label for="price">Price (CHF) *</label>
                            <p:inputNumber id="price" value="#{propertyBean.price}" 
                                         required="true" requiredMessage="Price is required"
                                         symbol=" CHF" symbolPosition="s" 
                                         decimalSeparator="." thousandSeparator="'"
                                         minValue="1" placeholder="500000"/>
                            <p:message for="price"/>
                        </div>
                        
                        <div class="p-field">
                            <label for="squareFootage">Size (sqm) *</label>
                            <p:spinner id="squareFootage" value="#{propertyBean.squareFootage}" 
                                      required="true" requiredMessage="Size is required"
                                      min="1" max="100000" stepFactor="10"/>
                            <p:message for="squareFootage"/>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="p-field">
                            <label for="bedrooms">Bedrooms *</label>
                            <p:spinner id="bedrooms" value="#{propertyBean.bedrooms}" 
                                      required="true" requiredMessage="Bedrooms is required"
                                      min="0" max="20" stepFactor="1"/>
                            <p:message for="bedrooms"/>
                        </div>
                        
                        <div class="p-field">
                            <label for="bathrooms">Bathrooms *</label>
                            <p:spinner id="bathrooms" value="#{propertyBean.bathrooms}" 
                                      required="true" requiredMessage="Bathrooms is required"
                                      min="0" max="20" stepFactor="1"/>
                            <p:message for="bathrooms"/>
                        </div>
                    </div>
                    
                    <div class="p-field">
                        <label for="description">Description</label>
                        <p:inputTextarea id="description" value="#{propertyBean.description}" 
                                       rows="4" autoResize="true"
                                       placeholder="Describe your property in detail..."/>
                        <p:message for="description"/>
                    </div>
                    
                    <div class="form-actions">
                        <p:commandButton value="List Property" action="#{propertyBean.addProperty()}" 
                                       icon="pi pi-check" styleClass="ui-button-success"/>
                        <p:commandButton value="Cancel" action="/seller/my-properties?faces-redirect=true" 
                                       immediate="true" icon="pi pi-times" styleClass="ui-button-secondary"/>
                    </div>
                </h:form>
            </div>
        </div>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=VOTRE_CLE_API_ICI&amp;libraries=places&amp;loading=async" async="async" defer="defer"></script>

    <script>
        function initAutocomplete() {
            // On cible l'input via la classe qu'on a ajoutée
            const input = document.querySelector('.address-input');

            if (input) {
                const options = {
                    // Restreindre aux adresses géographiques
                    types: ['geocode'],
                    // Optionnel : Restreindre à la Suisse (ch) pour des résultats plus pertinents
                    componentRestrictions: { country: 'ch' },
                    fields: ['formatted_address', 'geometry', 'name']
                };

                const autocomplete = new google.maps.places.Autocomplete(input, options);

                // Écouteur : Quand l'utilisateur sélectionne une adresse
                autocomplete.addListener('place_changed', function() {
                    const place = autocomplete.getPlace();

                    // Si l'utilisateur a tapé mais pas sélectionné dans la liste
                    if (!place.geometry) {
                        return;
                    }

                    // Mettre à jour la valeur visuelle (optionnel, Google le fait souvent seul)
                    input.value = place.formatted_address;

                    // IMPORTANT : Déclencher un événement 'change' pour que JSF/PrimeFaces
                    // sache que la valeur a changé (sinon le Bean risque de recevoir l'ancienne valeur)
                    input.dispatchEvent(new Event('change'));
                });
            }
        }

        // Lancer le script une fois la fenêtre chargée
        window.onload = function() {
            // Petite sécurité pour attendre que l'API Google soit prête
            if (typeof google !== 'undefined' &amp;&amp; google.maps &amp;&amp; google.maps.places) {
                initAutocomplete();
            } else {
                // Si l'API charge lentement, on réessaye dans 500ms
                setTimeout(initAutocomplete, 500);
            }
        };

        // Empêcher la touche "Entrée" de soumettre le formulaire quand on choisit une adresse
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' &amp;&amp; document.activeElement.classList.contains('address-input')) {
                event.preventDefault(); // Bloque l'envoi du formulaire
                return false;
            }
        });
    </script>
</h:body>
</html>
